<!DOCTYPE html>
<html lang="en">
<head>
    <title>Markdown Garden</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="viewer-page">
    <!-- Floating Header -->
    <div class="floating-header">
        <div class="header-left">
            <a href="?file=index.md">üè† Home</a>
            <a href="#" onclick="loadRandomDoc(); return false;">üé≤ Random</a>
        </div>
        
        <div class="header-right">
            <span class="current-doc" id="current-doc-display">Loading...</span>
        </div>
    </div>

    <!-- Rest of your HTML remains the same -->
    ...
    <br><br><br>
<!-- Main Content -->
    <div class="viewer-container">
        <main class="viewer-main">
            <div id="content" class="markdown-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading your document...</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Simple universal markdown loader
        const urlParams = new URLSearchParams(window.location.search);
        const file = urlParams.get('file') || 'index.md';
        
        // Update current document display
        function updateCurrentDoc() {
            const display = document.getElementById('current-doc-display');
            const friendlyName = file.replace('.md', '').replace(/-/g, ' ');
            display.textContent = `${file}`;
            document.title = `${friendlyName} - Markdown Garden`;
        }
        
        updateCurrentDoc();
        
        fetch(file)
            .then(response => {
                if (!response.ok) throw new Error('File not found');
                return response.text();
            })
            .then(markdown => {
                document.getElementById('content').innerHTML = marked.parse(markdown);
                
                // Apply syntax highlighting
                setTimeout(() => {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                    
                    // Add copy buttons to code blocks
                    addCopyButtons();
                    
                    // Add smooth scrolling for anchor links
                    addSmoothScrolling();
                }, 100);
            })
            .catch(error => {
                document.getElementById('content').innerHTML = 
                    `<div class="error">
                        <h3>üå± Document Not Found</h3>
                        <p>Could not load: <code>${file}</code></p>
                        <p><a href="?file=index.md">‚Üê Back to Home</a></p>
                    </div>`;
            });

        // Add copy buttons to all code blocks
        function addCopyButtons() {
            document.querySelectorAll('pre').forEach((preBlock) => {
                // Skip if already has copy button
                if (preBlock.querySelector('.copy-button')) return;
                
                // Create copy button
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-button';
                copyButton.textContent = 'Copy';
                copyButton.setAttribute('aria-label', 'Copy code to clipboard');
                
                // Add click event
                copyButton.addEventListener('click', async () => {
                    const code = preBlock.querySelector('code')?.innerText || preBlock.innerText;
                    
                    try {
                        await navigator.clipboard.writeText(code);
                        copyButton.textContent = 'Copied!';
                        copyButton.classList.add('copied');
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            copyButton.textContent = 'Copy';
                            copyButton.classList.remove('copied');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy:', err);
                        copyButton.textContent = 'Failed';
                        setTimeout(() => {
                            copyButton.textContent = 'Copy';
                        }, 2000);
                    }
                });
                
                // Add button to pre block
                preBlock.style.position = 'relative';
                preBlock.appendChild(copyButton);
            });
        }

        // Add smooth scrolling for anchor links
        function addSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        const headerHeight = 80;
                        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - headerHeight;
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Simple random document loader
        async function loadRandomDoc() {
            const knownFiles = ['index.md', 'nvim.md', 'LICENSE.md', 'README.md'];
            const randomFile = knownFiles[Math.floor(Math.random() * knownFiles.length)];
            window.location.href = `?file=${randomFile}`;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Alt + R for random document
            if (e.altKey && e.key === 'r') {
                loadRandomDoc();
            }
            // Escape key to go home
            if (e.key === 'Escape') {
                window.location.href = '?file=index.md';
            }
            // Home key to scroll to top
            if (e.key === 'Home') {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Update header on scroll (add shadow when scrolled)
        window.addEventListener('scroll', () => {
            const header = document.querySelector('.floating-header');
            if (window.scrollY > 10) {
                header.style.boxShadow = '0 4px 30px rgba(0,0,0,0.4)';
            } else {
                header.style.boxShadow = '0 2px 20px rgba(0,0,0,0.3)';
            }
        });
    </script>
</body>
</html>
